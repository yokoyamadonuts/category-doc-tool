{
  "id": "snapshot_1763635491017_ste357gnx",
  "approvalId": "approval_1763635491015_sbfl2j830",
  "approvalTitle": "Design Document for CatDoc MVP",
  "version": 1,
  "timestamp": "2025-11-20T10:44:51.017Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nCategory Documentation Tool (CatDoc) MVPは、圏論の概念を活用してドキュメント間の関係性を管理するCLIツール＋Webダッシュボードです。本設計では、Svelte + Hono + Tursoのモダンな技術スタックを採用し、Clean Architectureの原則に基づいた保守性の高いシステムを構築します。\n\n主要な設計目標：\n- **圏論のドメインロジックを純粋なTypeScriptで実装**（外部依存なし）\n- **HonoによるシンプルなAPI層**（CLIとWebダッシュボード両方をサポート）\n- **Tursoによる高速なSQLiteベースのストレージ**（ローカル＋リモート対応）\n- **Svelteによる軽量で高速なUI**（React Flowの代わりに軽量なグラフライブラリを使用）\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\ntech.mdはGo + Reactを想定していましたが、以下の理由でSvelte + Hono + Tursoに変更します：\n\n**変更の妥当性：**\n- **Hono (TypeScript)**: Go同様に高速で、型安全性を提供。Bunランタイムで実行すればGoに匹敵するパフォーマンス\n- **Svelte**: React Flowより軽量で、バンドルサイズが小さく、ビルドが高速\n- **Turso**: SQLiteベースでGit friendlyなデータ永続化を実現。tech.mdの「File-based JSON」よりもクエリ性能が高い\n\n**維持する原則：**\n- **3層アーキテクチャ**: Domain（圏論ロジック） → Application（CLI/API） → Infrastructure（DB/File）\n- **Repository pattern**: データアクセスの抽象化\n- **TDD workflow**: Gate-A/B/C による品質保証\n- **パフォーマンス目標**: 起動1秒、検証1秒、レンダリング5秒（100ノード）\n\n### Project Structure (structure.md)\n\nstructure.mdのGo構造を、TypeScript + Svelteの慣習に適応させます：\n\n```\ncategory-doc-tool/\n├── src/\n│   ├── domain/                  # 圏論コアロジック（純粋なTypeScript）\n│   │   ├── entities/\n│   │   │   ├── Object.ts        # オブジェクト定義\n│   │   │   ├── Morphism.ts      # モーフィズム定義\n│   │   │   ├── Category.ts      # カテゴリ定義\n│   │   │   ├── Functor.ts       # 関手定義\n│   │   │   └── NaturalTransformation.ts # 自然変換定義\n│   │   ├── services/\n│   │   │   ├── CompositionService.ts  # 合成ロジック\n│   │   │   ├── VerificationService.ts # 公理検証\n│   │   │   └── TraversalService.ts    # グラフ探索\n│   │   └── interfaces/\n│   │       └── IRepository.ts   # Repository interface\n│   ├── application/             # ユースケース層\n│   │   ├── cli/                 # CLIコマンド\n│   │   │   ├── init.ts\n│   │   │   ├── import.ts\n│   │   │   ├── validate.ts\n│   │   │   ├── search.ts\n│   │   │   ├── trace.ts\n│   │   │   └── dashboard.ts\n│   │   └── api/                 # APIエンドポイント（Hono）\n│   │       ├── objects.ts       # /api/objects\n│   │       ├── morphisms.ts     # /api/morphisms\n│   │       ├── functors.ts      # /api/functors\n│   │       ├── graph.ts         # /api/graph\n│   │       └── validate.ts      # /api/validate\n│   ├── infrastructure/          # 外部依存層\n│   │   ├── database/\n│   │   │   ├── turso.ts         # Turso接続設定\n│   │   │   ├── schema.ts        # テーブル定義\n│   │   │   └── repositories/\n│   │   │       ├── ObjectRepository.ts\n│   │   │       ├── MorphismRepository.ts\n│   │   │       ├── CategoryRepository.ts\n│   │   │       ├── FunctorRepository.ts\n│   │   │       └── NaturalTransformationRepository.ts\n│   │   ├── parsers/\n│   │   │   ├── YamlParser.ts    # category.yaml解析\n│   │   │   └── MarkdownParser.ts # Markdown解析\n│   │   └── cache/\n│   │       └── GraphCache.ts    # インメモリグラフキャッシュ\n│   ├── presentation/            # UI層（Svelte）\n│   │   ├── lib/\n│   │   │   ├── components/\n│   │   │   │   ├── GraphView.svelte       # グラフ可視化\n│   │   │   │   ├── ObjectList.svelte      # オブジェクト一覧\n│   │   │   │   ├── MorphismList.svelte    # モーフィズム一覧\n│   │   │   │   ├── FunctorView.svelte     # 関手可視化\n│   │   │   │   ├── CategorySelector.svelte # カテゴリ選択\n│   │   │   │   └── DetailPanel.svelte     # 詳細パネル\n│   │   │   ├── stores/\n│   │   │   │   ├── categoryStore.ts # カテゴリデータストア\n│   │   │   │   └── uiStore.ts       # UI状態管理\n│   │   │   └── utils/\n│   │   │       ├── graphLayout.ts   # レイアウトアルゴリズム\n│   │   │       └── apiClient.ts     # API通信\n│   │   ├── routes/\n│   │   │   └── +page.svelte         # メインページ\n│   │   └── app.html\n│   ├── index.ts                 # CLIエントリーポイント\n│   └── server.ts                # Honoサーバー\n├── tests/\n│   ├── domain/                  # ドメインロジックのテスト\n│   │   ├── Object.test.ts\n│   │   ├── Composition.test.ts\n│   │   ├── Verification.test.ts\n│   │   ├── Functor.test.ts\n│   │   └── NaturalTransformation.test.ts\n│   ├── integration/             # 統合テスト\n│   │   ├── cli.test.ts\n│   │   └── api.test.ts\n│   └── fixtures/                # テストデータ\n│       ├── simple-category.yaml\n│       └── multi-domain.yaml\n├── package.json\n├── tsconfig.json\n├── vite.config.ts               # Svelteビルド設定\n└── bun.lockb\n```\n\n**命名規則：**\n- TypeScript: PascalCase（クラス/インターフェース）、camelCase（関数/変数）\n- Svelte: PascalCase.svelte（コンポーネント）\n- テスト: [filename].test.ts\n\n## Code Reuse Analysis\n\n新規プロジェクトのため、既存コードの再利用はありませんが、以下のライブラリを活用します：\n\n### Existing Components to Leverage\n\n**TypeScript Ecosystem:**\n- **Hono**: 軽量で高速なWebフレームワーク（Express/Fastifyの代替）\n- **@libsql/client**: Turso公式クライアント\n- **zod**: スキーマバリデーション（YAML/JSONの検証）\n- **yaml**: category.yamlの解析\n- **commander**: CLIコマンドパーサー\n\n**Svelte Ecosystem:**\n- **svelte-graph** または **cytoscape.js**: グラフ可視化（React Flowの代替）\n- **@sveltejs/kit**: Svelteアプリケーションフレームワーク\n- **svelte/store**: 状態管理\n\n### Integration Points\n\n- **Turso Database**: ローカルSQLite + リモート同期（オプション）\n- **File System**: `.catdoc/category.yaml`、Markdownファイルの読み込み\n- **標準出力**: CLIのフィードバック表示\n\n## Architecture\n\n### 全体アーキテクチャ図\n\n```mermaid\ngraph TB\n    subgraph \"Presentation Layer\"\n        CLI[CLI Commands]\n        WEB[Svelte Dashboard]\n    end\n\n    subgraph \"Application Layer\"\n        API[Hono API Endpoints]\n        UC[Use Cases]\n    end\n\n    subgraph \"Domain Layer\"\n        ENT[Entities: Object, Morphism, Functor, NatTransform]\n        SVC[Services: Composition, Verification, Traversal]\n    end\n\n    subgraph \"Infrastructure Layer\"\n        REPO[Repositories]\n        TURSO[(Turso DB)]\n        YAML[YAML Parser]\n        CACHE[Graph Cache]\n    end\n\n    CLI --> UC\n    WEB --> API\n    API --> UC\n    UC --> SVC\n    SVC --> ENT\n    UC --> REPO\n    REPO --> TURSO\n    REPO --> CACHE\n    UC --> YAML\n\n    style ENT fill:#e1f5e1\n    style SVC fill:#e1f5e1\n    style TURSO fill:#ffe6e6\n```\n\n### Modular Design Principles\n\n- **Single File Responsibility**: 各ファイルは1つのエンティティ/サービス/コンポーネントを定義\n- **Component Isolation**: Svelteコンポーネントは独立して動作可能（propsのみで通信）\n- **Service Layer Separation**: ドメインサービスはRepositoryインターフェースに依存（実装には依存しない）\n- **Utility Modularity**: グラフレイアウト、バリデーション、パーサーは独立したユーティリティとして実装\n\n### 依存の方向\n\n```\nPresentation → Application → Domain\n                           ↑\n                Infrastructure\n```\n\n- **Domain層**: 外部依存ゼロ（純粋なTypeScript）\n- **Application層**: Domain層のインターフェースに依存\n- **Infrastructure層**: Domain層のインターフェースを実装\n- **Presentation層**: Application層を通じてDomain層を利用\n\n## Components and Interfaces\n\n### Domain Layer\n\n#### Object Entity\n- **Purpose:** 圏論のオブジェクト（ドキュメント）を表現\n- **Interfaces:**\n  ```typescript\n  class Object {\n    constructor(id: string, title: string, domain: string, metadata: Record<string, any>, content?: string)\n    getId(): string\n    getTitle(): string\n    getDomain(): string\n    getMetadata(): Record<string, any>\n    getContent(): string | undefined\n  }\n  ```\n- **Dependencies:** なし\n- **Reuses:** なし\n\n#### Morphism Entity\n- **Purpose:** 圏論の射（ドキュメント間の関係）を表現\n- **Interfaces:**\n  ```typescript\n  class Morphism {\n    constructor(id: string, name: string, source: string, target: string, metadata?: Record<string, any>)\n    getId(): string\n    getName(): string\n    getSource(): string\n    getTarget(): string\n    compose(other: Morphism): Morphism | null  // 合成可能性チェック\n  }\n  ```\n- **Dependencies:** Object（source/targetの参照）\n- **Reuses:** なし\n\n#### Category Entity\n- **Purpose:** カテゴリ（ドメイン層）を表現\n- **Interfaces:**\n  ```typescript\n  class Category {\n    constructor(id: string, name: string, objects: Object[], morphisms: Morphism[])\n    getId(): string\n    getName(): string\n    getObjects(): Object[]\n    getMorphisms(): Morphism[]\n    getObject(id: string): Object | undefined\n    getMorphism(id: string): Morphism | undefined\n  }\n  ```\n- **Dependencies:** Object, Morphism\n- **Reuses:** なし\n\n#### Functor Entity\n- **Purpose:** 異なるカテゴリ間の関手を表現\n- **Interfaces:**\n  ```typescript\n  class Functor {\n    constructor(\n      id: string,\n      name: string,\n      sourceCategory: string,\n      targetCategory: string,\n      objectMapping: Map<string, string>,\n      morphismMapping: Map<string, string>\n    )\n    mapObject(objectId: string): string | undefined\n    mapMorphism(morphismId: string): string | undefined\n    preservesIdentity(): boolean  // 恒等射の保存チェック\n    preservesComposition(): boolean  // 合成の保存チェック\n  }\n  ```\n- **Dependencies:** Category\n- **Reuses:** なし\n\n#### NaturalTransformation Entity\n- **Purpose:** 関手間の自然変換を表現\n- **Interfaces:**\n  ```typescript\n  class NaturalTransformation {\n    constructor(\n      id: string,\n      name: string,\n      sourceFunctor: string,\n      targetFunctor: string,\n      components: Map<string, string>  // object id -> morphism id\n    )\n    getComponent(objectId: string): string | undefined\n    satisfiesNaturality(): boolean  // 自然性条件チェック\n  }\n  ```\n- **Dependencies:** Functor, Morphism\n- **Reuses:** なし\n\n#### VerificationService\n- **Purpose:** 圏論の公理検証（恒等射、結合律、関手公理、自然性）\n- **Interfaces:**\n  ```typescript\n  class VerificationService {\n    verifyCategory(category: Category): VerificationResult\n    verifyFunctor(functor: Functor, source: Category, target: Category): VerificationResult\n    verifyNaturalTransformation(natTrans: NaturalTransformation, ...): VerificationResult\n  }\n\n  interface VerificationResult {\n    isValid: boolean\n    errors: string[]\n    warnings: string[]\n  }\n  ```\n- **Dependencies:** Category, Functor, NaturalTransformation\n- **Reuses:** CompositionService\n\n#### CompositionService\n- **Purpose:** 射の合成、関手の合成を計算\n- **Interfaces:**\n  ```typescript\n  class CompositionService {\n    composeMorphisms(f: Morphism, g: Morphism): Morphism | null\n    composeFunctors(f: Functor, g: Functor): Functor | null\n  }\n  ```\n- **Dependencies:** Morphism, Functor\n- **Reuses:** なし\n\n#### TraversalService\n- **Purpose:** グラフ探索、変換パスの探索\n- **Interfaces:**\n  ```typescript\n  class TraversalService {\n    findPath(source: string, target: string, category: Category): Morphism[]\n    findDomainPath(sourceObj: string, targetCat: string, ...): TransformationPath[]\n  }\n\n  interface TransformationPath {\n    steps: Array<Functor | NaturalTransformation>\n    resultObject: string\n  }\n  ```\n- **Dependencies:** Category, Functor, NaturalTransformation\n- **Reuses:** なし\n\n### Application Layer\n\n#### CLI Commands\n- **Purpose:** CLIインターフェースを提供\n- **Interfaces:** `catdoc init`, `catdoc import`, `catdoc validate`, `catdoc search`, `catdoc trace`, `catdoc dashboard`\n- **Dependencies:** VerificationService, TraversalService, Repositories\n- **Reuses:** commander（CLIパーサー）\n\n#### API Endpoints (Hono)\n- **Purpose:** Web ダッシュボード用のRESTful API\n- **Interfaces:**\n  ```typescript\n  GET /api/categories          // 全カテゴリ取得\n  GET /api/categories/:id      // カテゴリ詳細\n  GET /api/objects             // 全オブジェクト取得\n  GET /api/morphisms           // 全モーフィズム取得\n  GET /api/functors            // 全関手取得\n  GET /api/graph               // グラフデータ取得\n  POST /api/validate           // 検証実行\n  POST /api/trace              // 変換パス探索\n  ```\n- **Dependencies:** 全Domainサービス、Repositories\n- **Reuses:** Hono\n\n### Infrastructure Layer\n\n#### Turso Database\n- **Purpose:** データ永続化とクエリ\n- **Interfaces:**\n  ```typescript\n  class TursoConnection {\n    connect(url: string, authToken: string): Promise<void>\n    execute(sql: string, params: any[]): Promise<Result>\n    close(): Promise<void>\n  }\n  ```\n- **Dependencies:** @libsql/client\n- **Reuses:** Turso公式SDK\n\n#### Repositories\n- **Purpose:** データアクセス抽象化（Repository pattern）\n- **Interfaces:**\n  ```typescript\n  interface IObjectRepository {\n    findAll(): Promise<Object[]>\n    findById(id: string): Promise<Object | null>\n    save(obj: Object): Promise<void>\n    delete(id: string): Promise<void>\n  }\n  // 同様にMorphism, Category, Functor, NaturalTransformationRepositoryも定義\n  ```\n- **Dependencies:** TursoConnection, Domain Entities\n- **Reuses:** なし\n\n#### YamlParser\n- **Purpose:** category.yamlの解析とバリデーション\n- **Interfaces:**\n  ```typescript\n  class YamlParser {\n    parse(filePath: string): Promise<CategoryConfig>\n    validate(config: CategoryConfig): ValidationResult\n  }\n\n  interface CategoryConfig {\n    categories: CategoryDef[]\n    morphisms: MorphismDef[]\n    functors: FunctorDef[]\n    naturalTransformations: NatTransDef[]\n  }\n  ```\n- **Dependencies:** yaml, zod\n- **Reuses:** yaml（YAML解析）、zod（バリデーション）\n\n### Presentation Layer (Svelte)\n\n#### GraphView.svelte\n- **Purpose:** グラフの可視化とインタラクション\n- **Interfaces:** Props: `{ categories: Category[], selectedCategory?: string }`\n- **Dependencies:** cytoscape.js または svelte-graph\n- **Reuses:** グラフライブラリ\n\n#### ObjectList.svelte\n- **Purpose:** オブジェクト一覧表示\n- **Interfaces:** Props: `{ objects: Object[], onSelect: (id: string) => void }`\n- **Dependencies:** categoryStore\n- **Reuses:** なし\n\n#### FunctorView.svelte\n- **Purpose:** 関手のマッピングを可視化\n- **Interfaces:** Props: `{ functor: Functor, sourceCategory: Category, targetCategory: Category }`\n- **Dependencies:** GraphViewコンポーネント\n- **Reuses:** GraphView.svelte\n\n## Data Models\n\n### Database Schema (Turso)\n\n#### objects テーブル\n```sql\nCREATE TABLE objects (\n  id TEXT PRIMARY KEY,\n  title TEXT NOT NULL,\n  domain TEXT NOT NULL,\n  category_id TEXT NOT NULL,\n  metadata TEXT,  -- JSON形式\n  content TEXT,   -- Markdownコンテンツ\n  created_at INTEGER DEFAULT (strftime('%s', 'now')),\n  FOREIGN KEY (category_id) REFERENCES categories(id)\n);\nCREATE INDEX idx_objects_domain ON objects(domain);\nCREATE INDEX idx_objects_category ON objects(category_id);\n```\n\n#### morphisms テーブル\n```sql\nCREATE TABLE morphisms (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  source_id TEXT NOT NULL,\n  target_id TEXT NOT NULL,\n  category_id TEXT NOT NULL,\n  metadata TEXT,  -- JSON形式\n  created_at INTEGER DEFAULT (strftime('%s', 'now')),\n  FOREIGN KEY (source_id) REFERENCES objects(id),\n  FOREIGN KEY (target_id) REFERENCES objects(id),\n  FOREIGN KEY (category_id) REFERENCES categories(id)\n);\nCREATE INDEX idx_morphisms_source ON morphisms(source_id);\nCREATE INDEX idx_morphisms_target ON morphisms(target_id);\nCREATE INDEX idx_morphisms_category ON morphisms(category_id);\n```\n\n#### categories テーブル\n```sql\nCREATE TABLE categories (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  description TEXT,\n  created_at INTEGER DEFAULT (strftime('%s', 'now'))\n);\n```\n\n#### functors テーブル\n```sql\nCREATE TABLE functors (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  source_category_id TEXT NOT NULL,\n  target_category_id TEXT NOT NULL,\n  object_mapping TEXT NOT NULL,  -- JSON: {\"sourceObjId\": \"targetObjId\"}\n  morphism_mapping TEXT NOT NULL, -- JSON: {\"sourceMorphId\": \"targetMorphId\"}\n  created_at INTEGER DEFAULT (strftime('%s', 'now')),\n  FOREIGN KEY (source_category_id) REFERENCES categories(id),\n  FOREIGN KEY (target_category_id) REFERENCES categories(id)\n);\n```\n\n#### natural_transformations テーブル\n```sql\nCREATE TABLE natural_transformations (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  source_functor_id TEXT NOT NULL,\n  target_functor_id TEXT NOT NULL,\n  components TEXT NOT NULL,  -- JSON: {\"objectId\": \"morphismId\"}\n  created_at INTEGER DEFAULT (strftime('%s', 'now')),\n  FOREIGN KEY (source_functor_id) REFERENCES functors(id),\n  FOREIGN KEY (target_functor_id) REFERENCES functors(id)\n);\n```\n\n### category.yaml スキーマ例\n\n```yaml\ncategories:\n  - id: business-domain\n    name: Business Domain\n    description: 業務ドメインのドキュメント\n  - id: spec-domain\n    name: Specification Domain\n    description: 仕様ドメインのドキュメント\n\nmorphisms:\n  - id: morph-001\n    name: depends-on\n    source: obj-001\n    target: obj-002\n    category: business-domain\n\nfunctors:\n  - id: functor-business-to-spec\n    name: BusinessToSpec\n    source_category: business-domain\n    target_category: spec-domain\n    object_mapping:\n      obj-001: spec-obj-001\n      obj-002: spec-obj-002\n    morphism_mapping:\n      morph-001: spec-morph-001\n\nnatural_transformations:\n  - id: nat-trans-001\n    name: Refinement\n    source_functor: functor-business-to-spec\n    target_functor: functor-business-to-spec-v2\n    components:\n      obj-001: morph-refine-001\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Scenario: Tursoデータベース接続失敗**\n   - **Handling:**\n     - 3回リトライ（指数バックオフ）\n     - 失敗時はローカルSQLiteにフォールバック\n     - エラーログを `.catdoc/error.log` に記録\n   - **User Impact:** CLI: \"⚠️  Database connection failed. Using local mode.\" / Dashboard: 接続エラーバナー表示\n\n2. **Scenario: category.yaml解析エラー**\n   - **Handling:**\n     - zodバリデーションでスキーマチェック\n     - 詳細なエラーメッセージ（行番号、フィールド名）を表示\n     - 部分的に有効なデータは読み込み（warnings表示）\n   - **User Impact:** \"❌ Invalid YAML at line 15: 'source_category' is required\"\n\n3. **Scenario: 圏の公理違反（恒等射なし、結合律違反）**\n   - **Handling:**\n     - VerificationServiceで検出\n     - 違反箇所を具体的にレポート（オブジェクトID、射名）\n     - 自動修正の提案（可能な場合）\n   - **User Impact:** \"⚠️  Category 'business-domain': Missing identity morphism for object 'obj-001'. Run `catdoc fix` to auto-generate.\"\n\n4. **Scenario: 関手の公理違反**\n   - **Handling:**\n     - 恒等射の保存、合成の保存をチェック\n     - 違反するマッピングを具体的に表示\n   - **User Impact:** \"❌ Functor 'BusinessToSpec': Does not preserve composition: f∘g ≠ F(f)∘F(g) for morphisms 'morph-001', 'morph-002'\"\n\n5. **Scenario: 自然変換の自然性条件違反**\n   - **Handling:**\n     - 可換図式をチェック\n     - どのオブジェクトで可換性が崩れるか表示\n   - **User Impact:** \"❌ Natural transformation 'Refinement': Naturality fails at object 'obj-001'\"\n\n6. **Scenario: Markdownファイルが見つからない**\n   - **Handling:**\n     - ファイルパス存在チェック\n     - 類似パスを提案（Levenshtein距離）\n   - **User Impact:** \"❌ File not found: './docs/business.md'. Did you mean './doc/business.md'?\"\n\n7. **Scenario: グラフレンダリングタイムアウト（1000+ノード）**\n   - **Handling:**\n     - 進捗バー表示\n     - 10秒以上かかる場合は中断確認\n     - クラスタリング表示の提案\n   - **User Impact:** \"⏳ Rendering 1500 nodes... This may take a while. Press Ctrl+C to cancel.\"\n\n## Testing Strategy\n\n### Unit Testing\n\n**対象:**\n- Domain層のすべてのエンティティとサービス\n- Infrastructure層のRepositories（モックDB使用）\n- Parsers、Validators\n\n**ツール:**\n- **Vitest**: 高速なTypeScriptテストランナー\n- **Bun:test**: Bunネイティブのテスト機能\n\n**カバレッジ目標:** 80%以上\n\n**重点テストケース:**\n- `Morphism.compose()`: 合成可能性のすべての組み合わせ\n- `VerificationService.verifyCategory()`: 恒等射、結合律のエッジケース\n- `VerificationService.verifyFunctor()`: 関手の公理（恒等射保存、合成保存）\n- `VerificationService.verifyNaturalTransformation()`: 自然性条件\n- `TraversalService.findDomainPath()`: 複雑なドメイン階層でのパス探索\n\n**Property-based Testing:**\n- 任意の射の合成が結合律を満たすか（fast-check使用）\n- 任意の関手が公理を満たすか\n\n### Integration Testing\n\n**対象:**\n- CLI全コマンド（init, import, validate, search, trace, dashboard）\n- API全エンドポイント（GET/POST）\n- YAML解析 → DB保存 → 検証のフルフロー\n\n**ツール:**\n- **Vitest**: 統合テスト実行\n- **supertest**: Hono APIテスト\n\n**テストシナリオ:**\n1. `catdoc init` → `.catdoc/` 作成 → Turso DB初期化\n2. `catdoc import docs/*.md` → オブジェクト保存 → `catdoc list` で確認\n3. `category.yaml` 作成 → `catdoc validate` → エラーレポート検証\n4. `catdoc trace obj-001 spec-domain` → 変換パス探索\n5. `catdoc dashboard` → Honoサーバー起動 → `/api/graph` レスポンス確認\n\n### End-to-End Testing\n\n**対象:**\n- ユーザーの実際の操作フロー（CLI + Webダッシュボード）\n\n**ツール:**\n- **Playwright**: Svelteダッシュボードのブラウザテスト\n- **CLI統合テスト**: シェルスクリプトでコマンド実行\n\n**ユーザーシナリオ:**\n1. **新規プロジェクト作成:**\n   - `catdoc init`\n   - `catdoc import docs/business/*.md`\n   - `catdoc import docs/spec/*.md`\n   - `category.yaml` 編集（関手とモーフィズム定義）\n   - `catdoc validate`\n   - エラー修正\n   - `catdoc dashboard` 起動\n   - ブラウザでグラフ確認\n\n2. **ドメイン間トレース:**\n   - `catdoc trace business-req-001 implementation-domain`\n   - 複数パスの表示確認\n   - ダッシュボードでパスをビジュアル確認\n\n3. **関手の可視化:**\n   - ダッシュボードで「関手表示」モード選択\n   - 特定の関手を選択\n   - マッピングがハイライト表示されることを確認\n\n**成功基準:**\n- すべてのシナリオが5分以内に完了\n- エラーメッセージが明確で実行可能\n- ダッシュボードが5秒以内にロード\n\n## Performance Considerations\n\n**最適化戦略:**\n1. **グラフキャッシュ**: インメモリで隣接リストを保持（検証・探索の高速化）\n2. **遅延ロード**: ダッシュボードで可視範囲のノードのみレンダリング\n3. **インデックス**: Turso DBで適切なインデックス作成（source_id, target_id, category_id）\n4. **バッチ処理**: 大量インポート時はトランザクションでバッチ挿入\n5. **Web Workers**: グラフレイアウト計算をバックグラウンドスレッドで実行\n\n**ベンチマーク目標（requirements.mdより）:**\n- 起動時間: 1秒以内\n- 検証速度: 1000ノード、5000エッジを1秒以内\n- 関手検証: 10個の関手（各100マッピング）を500ms以内\n- 自然変換検証: 5個の自然変換を1秒以内\n- ドメイン間トレース: 5層のドメイン階層で500ms以内\n- グラフレンダリング: 100ノードを5秒以内\n",
  "fileStats": {
    "size": 25689,
    "lines": 706,
    "lastModified": "2025-11-20T10:44:40.901Z"
  },
  "comments": []
}